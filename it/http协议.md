# http

## 什么是 HTTP

绝大多数的 web 应用都是基于 HTTP 来进行开发，对 web 的操作都是通过 HTTP 协议进行传输数据。

**HTTP 协议是客户端和服务器交互的一种通讯格式**

所谓的交互，就是**请求**和**响应**,所谓的协议，实际上就是双方约定好的**格式**

HTTP 的诞生主要是为了**文档之间相互关联，形成超文本可以互相传阅**,可以认为**HTTP 是 web 通信的基础**

## HTTP 各个版本的特点

到目前为止，有以下的版本：

1. HTTP1.0
1. HTTP1.1
1. HTTP/2
1. HTTP/3

目前大多数使用的是 **HTTP1.1** 和 **HTTP/2**

**HTTP1.0** 默认是短连接，每次与服务器交互，都需要新开始一个连接

**HTTP1.1** 版本：

1. 最主要的是默认持久连接。只要客户端服务端任意一段没有明确提出断开 TCP 连接，就一直保持连接，可以发送多次 HTTP 请求
1. 其次就是断点续传（Chunked transfer-coding）。利用 HTTP 消息头使用分块传输编码，将实体主体分块传输。

**HTTP/2**版本：

1. 在 HTTP1.1 提出了管线化（pipelining）理论，但是默认都是关闭的。而 HTTP/2 允许同时通过单一的 TCP 连接发起多个请求和响应消息
1. 不再以文本方式传输，采用**二进制分帧层**，对头部进行压缩，支持流的控制

**HTTP/3**版本：

> Quic(QuickUDP Internet Connections)是一种新的传输方式，与 TCP 相比，它减少了延迟。表面上，Quic 非常类似于在 UDP 上实现的 TCP+TLS+HTTP/2

1. HTTP1.x 和 HTTP/2 底层都是 TCP，而 HTTP/3 底层是 UDP。使用 HTTP/3 能够减少 RTT（往返延时，包括 TCP 三次握手，TLS 握手）

## HTTPS

HTTP 协议默认是**明文**，如果在交互过程中被“挟持”了，传输的信息就会有暴露、篡改的风险。现在大部分网站用的是 HTTPS 协议，毕竟安全第一
HTTPS 是基于 TLS 上实现的

### 实现 (TODO:)

### 过程

网络上，客户端和服务端只要有交互，就存在被挟持的可能，客户端需要确切的确认服务端是不是真实的，所以需要 CA（公信机构）来帮助客户端确认服务端的真实性。

1. 服务端在使用 HTTPS 前，需要去认证的 CA 机构申请一份数字证书。数字证书内容包含证书持有者、证书有效期、服务器公钥等重要信息
1. CA 机构也有自己的公私钥，在发布数字证书之前，会以自己的私钥对这份数字证书加密
1. 客户端请求服务端时，服务端返回证书给客户端
1. 客户端用 CA 的公钥对证书解密（因为 CA 是公信机构，会内置到浏览器或操作系统中，所以客户端会有公钥）。这时，客户端会判断证书是否可信、有无被篡改。(ps:证书被 CA 机构私钥加密，然后客户端用 CA 证书的公钥解密。这种私钥加密，公钥解密的方式一般用来做数字签名，用以判断有无被篡改)
1. 客户端发现证书可信之后，解密出服务器的公钥。客户端生成一个对称加密的随机 key，并用证书内的公钥加密，发给服务端。
1. 服务端收到消息后，用自己的私钥解密，得到客户端随机生成的 key，加密数据后返回给客户端。
1. 客户端收到消息后，就可以用之前生成的 key 来解密服务端返回的数据了。

### 总结

1. 首先客户端跟服务器之间的交互，客户端需要知道服务端是不是真实的。因为客户端与服务端之间的通讯都有可能被「挟持」。所以需要有一个公信机构 CA 来让客户端知道服务端是真实的。
1. CA 机构将服务端的公钥信息用自己的私钥加密，客户端用 CA 机构的公钥解密。保证 CA 证书是没有被篡改，是真实的。
1. 客户端拿到 CA 证书，就能解析到服务端的公钥。客户端生成一个 Key 作为对称加密的秘钥，用服务端的公钥加密传给服务端。
1. 服务端用自己的私钥解密客户端的数据，得到对称加密的秘钥。
1. 后续就可以通过对称加密的秘钥愉快发送/接收消息了。
